<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Details - Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f8fafc; }

        nav { background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%); color: white; padding: 1rem 2rem; }
        .nav-container { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .logo { display: flex; align-items: center; gap: 10px; }
        .logo-icon { background: #fbbf24; color: #1e3a8a; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .logo-text { font-size: 1.5rem; font-weight: bold; }
        .nav-links a { color: white; text-decoration: none; margin-left: 2rem; }

        .admin-container { max-width: 1400px; margin: 2rem auto; padding: 0 2rem; }

        /* Admin Layout */
        .admin-layout { display: flex; gap: 2rem; }
        .admin-sidebar { width: 250px; background: white; border-radius: 10px; padding: 1.5rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1); height: fit-content; }
        .admin-sidebar h3 { color: #1e3a8a; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid #e5e7eb; }
        .admin-sidebar ul { list-style: none; }
        .admin-sidebar li { margin-bottom: 0.5rem; }
        .admin-sidebar a { color: #4b5563; text-decoration: none; display: block; padding: 0.5rem 1rem; border-radius: 5px; transition: all 0.3s; }
        .admin-sidebar a:hover { background: #f3f4f6; color: #1e40af; }
        .admin-sidebar a.active { background: #1e40af; color: white; }

        .admin-content { flex: 1; }

        /* User Profile */
        .user-profile { background: white; border-radius: 10px; padding: 2rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .profile-header { display: flex; align-items: center; gap: 2rem; margin-bottom: 2rem; }
        .profile-avatar { width: 100px; height: 100px; background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; color: white; }
        .profile-info h1 { margin-bottom: 0.5rem; }
        .profile-info p { color: #6b7280; }

        /* Stats Grid */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin: 2rem 0; }
        .stat-card { background: white; border-radius: 10px; padding: 1.5rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .stat-card h3 { color: #1e3a8a; margin-bottom: 0.5rem; }

        /* Info Grid */
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin: 2rem 0; }
        .info-card { background: white; border-radius: 10px; padding: 1.5rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .info-card h3 { color: #1e3a8a; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid #e5e7eb; }

        /* Status Badges */
        .status-badge { display: inline-block; padding: 0.5rem 1rem; border-radius: 9999px; font-weight: 500; }
        .status-active { background: #d1fae5; color: #065f46; }
        .status-inactive { background: #fef3c7; color: #92400e; }
        .status-admin { background: #6366f1; color: white; }

        /* Buttons */
        .btn { padding: 0.75rem 1.5rem; border: none; border-radius: 8px; cursor: pointer; text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem; font-weight: 500; }
        .btn-back { background: #6b7280; color: white; }
        .btn-toggle { background: #8b5cf6; color: white; }
        .btn-danger { background: #ef4444; color: white; }

        /* Tables */
        .data-table { width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-top: 1rem; }
        .data-table th, .data-table td { padding: 1rem; text-align: left; border-bottom: 1px solid #e5e7eb; }
        .data-table th { background: #f3f4f6; }
    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <div class="logo">
                <div class="logo-icon">TFV</div>
                <div class="logo-text">THREE FOLD VENTURES ADMIN</div>
            </div>
            <div class="nav-links">
                <span style="color: #fbbf24;"><i class="fas fa-user-shield"></i> {{ current_user.email }}</span>
                <a href="/">Home</a>
                <a href="/logout">Logout</a>
            </div>
        </div>
    </nav>

    <div class="admin-container">
        <div class="admin-layout">
            <!-- Sidebar -->
            <div class="admin-sidebar">
                <h3>Admin Panel</h3>
                <ul>
                    <li><a href="/admin"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                    <li><a href="/admin/users"><i class="fas fa-users"></i> Users</a></li>
                    <li><a href="/admin/subjects"><i class="fas fa-book"></i> Subjects</a></li>
                    <li><a href="/admin/lessons"><i class="fas fa-graduation-cap"></i> Lessons</a></li>
                    <li><a href="/admin/payments"><i class="fas fa-credit-card"></i> Payments</a></li>
                    <li><a href="/admin/analytics"><i class="fas fa-chart-line"></i> Analytics</a></li>
                </ul>
            </div>

            <!-- Main Content -->
            <div class="admin-content">
                <a href="{{ url_for('admin_users') }}" class="btn btn-back">
                    <i class="fas fa-arrow-left"></i> Back to Users
                </a>

                <!-- User Profile -->
                <div class="user-profile">
                    <div class="profile-header">
                        <div class="profile-avatar">
                            {{ user.name[0] if user.name else 'U' }}
                        </div>
                        <div class="profile-info">
                            <h1>{{ user.name or 'No Name Provided' }}</h1>
                            <p>{{ user.email }}</p>
                            <div style="margin-top: 1rem;">
                                {% if user.is_admin %}
                                <span class="status-badge status-admin">Administrator</span>
                                {% endif %}
                                {% if user.is_active %}
                                <span class="status-badge status-active">Active</span>
                                {% else %}
                                <span class="status-badge status-inactive">Inactive</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- User Stats -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>Enrollments</h3>
                            <p style="font-size: 2rem; color: #3b82f6;">{{ enrollments }}</p>
                            <small>Total courses enrolled</small>
                        </div>
                        <div class="stat-card">
                            <h3>Payments</h3>
                            <p style="font-size: 2rem; color: #10b981;">{{ payments }}</p>
                            <small>Total transactions</small>
                        </div>
                        <div class="stat-card">
                            <h3>Total Paid</h3>
                            <p style="font-size: 2rem; color: #8b5cf6;">{{ total_paid|int|format(',') }} MWK</p>
                            <small>Amount spent</small>
                        </div>
                        <div class="stat-card">
                            <h3>Member Since</h3>
                            <p style="font-size: 1.5rem; color: #f59e0b;">{{ user.created_at.strftime('%d %b %Y') }}</p>
                            <small>{{ ((now - user.created_at).days) }} days ago</small>
                        </div>
                    </div>

                    <!-- User Information -->
                    <div class="info-grid">
                        <div class="info-card">
                            <h3><i class="fas fa-info-circle"></i> Personal Information</h3>
                            <table style="width: 100%;">
                                <tr>
                                    <td style="padding: 0.5rem 0; color: #6b7280;">Email:</td>
                                    <td style="padding: 0.5rem 0; font-weight: 500;">{{ user.email }}</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.5rem 0; color: #6b7280;">Phone:</td>
                                    <td style="padding: 0.5rem 0; font-weight: 500;">{{ user.phone or 'Not provided' }}</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.5rem 0; color: #6b7280;">Student ID:</td>
                                    <td style="padding: 0.5rem 0; font-weight: 500;">{{ user.student_id or 'Not provided' }}</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.5rem 0; color: #6b7280;">Account Status:</td>
                                    <td style="padding: 0.5rem 0;">
                                        {% if user.is_active %}
                                        <span class="status-badge status-active">Active</span>
                                        {% else %}
                                        <span class="status-badge status-inactive">Inactive</span>
                                        {% endif %}
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <div class="info-card">
                            <h3><i class="fas fa-user-shield"></i> Admin Actions</h3>
                            <div style="display: flex; flex-direction: column; gap: 1rem; margin-top: 1rem;">
                                <a href="{{ url_for('toggle_admin', user_id=user.id) }}" class="btn btn-toggle"
                                   onclick="return confirm('{{ 'Remove admin privileges from ' if user.is_admin else 'Grant admin privileges to ' }}{{ user.email }}?')">
                                    <i class="fas fa-user-shield"></i>
                                    {{ 'Remove Admin Privileges' if user.is_admin else 'Make Administrator' }}
                                </a>

                                {% if user.id != current_user.id %}
                                <a href="{{ url_for('toggle_user_status', user_id=user.id) }}" class="btn {{ 'btn-danger' if user.is_active else 'btn-toggle' }}"
                                   onclick="return confirm('{{ 'Deactivate ' if user.is_active else 'Activate ' }}{{ user.email }} account?')">
                                    <i class="fas {{ 'fa-user-slash' if user.is_active else 'fa-user-check' }}"></i>
                                    {{ 'Deactivate Account' if user.is_active else 'Activate Account' }}
                                </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- User's Recent Activity -->
                    <div class="info-card" style="margin-top: 2rem;">
                        <h3><i class="fas fa-history"></i> Recent Activity</h3>
                        <p>Last login: {{ user.last_login.strftime('%Y-%m-%d %H:%M') if user.last_login else 'Never' }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>